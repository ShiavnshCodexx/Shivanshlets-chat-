<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shivanshcodex</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
body{
  min-height:100vh;
  background:#020617;
  color:#fff;
  overflow:hidden;
}
.hidden{display:none}

/* LIVE BACKGROUND */
.bg{
  position:fixed;inset:0;
  background:
    radial-gradient(circle at 20% 20%,rgba(0,255,156,.15),transparent 40%),
    radial-gradient(circle at 80% 30%,rgba(59,130,246,.15),transparent 40%),
    radial-gradient(circle at 50% 80%,rgba(168,85,247,.15),transparent 40%);
  animation:move 12s linear infinite;
  z-index:-1;
}
@keyframes move{
  50%{filter:hue-rotate(40deg)}
}

.container{
  max-width:420px;
  margin:auto;
  padding:20px;
}

h1{
  text-align:center;
  margin-bottom:20px;
  letter-spacing:1px;
}

.card{
  background:rgba(2,6,23,.85);
  backdrop-filter:blur(12px);
  border-radius:18px;
  padding:20px;
  box-shadow:0 0 30px rgba(0,0,0,.6);
}

input,button{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:15px;
  margin-top:12px;
}
input{background:#fff;color:#000}
button{font-weight:600;cursor:pointer}

.green{background:#00ff9c;color:#000}
.blue{background:#3b82f6;color:#fff}
.red{background:#ef4444;color:#fff}

/* CHAT */
.chat{
  height:60vh;
  overflow-y:auto;
  padding:10px;
  margin-bottom:10px;
}
.msg{
  max-width:80%;
  padding:10px 14px;
  border-radius:14px;
  margin-bottom:8px;
  font-size:14px;
}
.user{background:#00ff9c;color:#000;margin-left:auto}
.admin{background:#3b82f6}

.footer{
  display:flex;
  gap:8px;
}
.footer input{flex:1}
</style>
</head>

<body>
<div class="bg"></div>

<div class="container">

<!-- LOGIN -->
<div id="loginBox" class="card">
<h1>Shivanshcodex</h1>

<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<button class="green" onclick="login()">Enter</button>

<hr style="margin:18px 0;border:.5px solid #334155">

<input id="adminUser" placeholder="Admin Username">
<input id="adminPass" type="password" placeholder="Admin Password">
<button class="blue" onclick="adminLogin()">Admin Login</button>
</div>

<!-- CHAT -->
<div id="chatBox" class="card hidden">
<h1 id="chatTitle">Chat</h1>

<div class="chat" id="chat"></div>

<div class="footer">
  <input id="msg" placeholder="Type messageâ€¦">
  <button class="green" onclick="send()">Send</button>
</div>

<button class="red" onclick="logout()" style="margin-top:10px">Logout</button>
</div>

</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, push, get, onChildAdded } 
from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const app = initializeApp({
  apiKey: "AIzaSyAYsZ0jwE2uUVM8A0HPkq_cCYWWhb6eVlE",
  authDomain: "shivanshchat-b66da.firebaseapp.com",
  projectId: "shivanshchat-b66da",
  storageBucket: "shivanshchat-b66da.firebasestorage.app",
  messagingSenderId: "715877321366",
  appId: "1:715877321366:web:f7fcb3bb106518978350b7"
});

const db = getDatabase(app);

let currentUser = "";
let isAdmin = false;

/* USER LOGIN */
window.login = async () => {
  const u = username.value.trim();
  const p = password.value.trim();
  if(!u || !p) return alert("Fill all fields");

  const userRef = ref(db,"users/"+u);
  const snap = await get(userRef);

  if(!snap.exists()){
    await set(userRef,{password:p});
  }else if(snap.val().password !== p){
    return alert("Wrong password");
  }

  currentUser = u;
  openChat("Chat with Shivansh");
};

/* ADMIN LOGIN */
window.adminLogin = () => {
  if(
    adminUser.value === "shiavnsh@62718" &&
    adminPass.value === "chrome@7282"
  ){
    isAdmin = true;
    openChat("Admin Panel");
  } else {
    alert("Wrong admin login");
  }
};

function openChat(title){
  loginBox.classList.add("hidden");
  chatBox.classList.remove("hidden");
  chatTitle.innerText = title;
  chat.innerHTML = "";

  const path = isAdmin ? "messages" : "messages/"+currentUser;

  onChildAdded(ref(db,path),snap=>{
    const m = snap.val();
    const d = document.createElement("div");
    d.className = "msg " + m.by;
    d.innerText = m.text;
    chat.appendChild(d);
    chat.scrollTop = chat.scrollHeight;
  });
}

window.send = () => {
  if(!msg.value.trim()) return;

  const path = isAdmin ? "messages" : "messages/"+currentUser;
  push(ref(db,path),{
    text: msg.value,
    by: isAdmin ? "admin" : "user",
    time: Date.now()
  });
  msg.value = "";
};

window.logout = () => location.reload();
</script>
</body>
</html>
