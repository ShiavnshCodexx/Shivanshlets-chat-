<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShivanshCodex</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="center-box">
  <h2>ShivanshCodex</h2>

  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">

  <button id="signup">SIGN UP</button>
  <button id="login">LOGIN</button>

  <p id="msg"></p>
</div>

<script type="module">
import { db } from "./firebase.js";
import { ref, get, set } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const u = document.getElementById("username");
const p = document.getElementById("password");
const msg = document.getElementById("msg");

document.getElementById("signup").addEventListener("click", async () => {
  if(!u.value || !p.value){
    msg.innerText = "Fill all fields";
    return;
  }

  const userRef = ref(db, "users/" + u.value);
  const snap = await get(userRef);

  if(snap.exists()){
    msg.innerText = "Username already exists";
    return;
  }

  await set(userRef, {
    password: p.value,
    online: false
  });

  localStorage.setItem("user", u.value);
  location.href = "chat.html";
});

document.getElementById("login").addEventListener("click", async () => {
  const userRef = ref(db, "users/" + u.value);
  const snap = await get(userRef);

  if(!snap.exists() || snap.val().password !== p.value){
    msg.innerText = "Invalid login";
    return;
  }

  localStorage.setItem("user", u.value);
  location.href = "chat.html";
});
</script>

</body>
</html>
