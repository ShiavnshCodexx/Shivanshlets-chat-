<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ShivanshCodex Login</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="bg-grid"></div>
<div class="bg-scan"></div>
<div class="bg-glow"></div>

<div class="center-box">
  <h2>ShivanshCodex</h2>

  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">

  <button id="signupBtn">SIGN UP</button>
  <button id="loginBtn">LOGIN</button>

  <p id="msg"></p>
</div>

<script type="module">
import { db } from "./firebase.js";
import { ref, set, get } from
"https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const username = document.getElementById("username");
const password = document.getElementById("password");
const msg = document.getElementById("msg");

document.getElementById("signupBtn").addEventListener("click", signup);
document.getElementById("loginBtn").addEventListener("click", login);

async function signup(){
  const u = username.value.trim();
  const p = password.value.trim();

  if(!u || !p){
    msg.innerText = "Fill all fields";
    return;
  }

  const snap = await get(ref(db,"users/"+u));
  if(snap.exists()){
    msg.innerText = "Username already exists";
    return;
  }

  await set(ref(db,"users/"+u),{
    password:p,
    online:false
  });

  localStorage.setItem("user",u);
  location.href = "chat.html";
}

async function login(){
  const u = username.value.trim();
  const p = password.value.trim();

  const snap = await get(ref(db,"users/"+u));
  if(!snap.exists() || snap.val().password !== p){
    msg.innerText = "Invalid username or password";
    return;
  }

  localStorage.setItem("user",u);
  location.href = "chat.html";
}
</script>

</body>
</html>
