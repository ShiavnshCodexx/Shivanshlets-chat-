<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shivanshcodex</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
body{
  height:100vh;
  background:#0b141a;
  color:#fff;
  overflow:hidden;
}
.hidden{display:none}

/* ===== AUTH ===== */
.auth{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  width:100%;
  max-width:420px;
  background:#111b21;
  padding:22px;
  border-radius:18px;
}
h1{text-align:center;margin-bottom:18px}

input,button{
  width:100%;
  padding:14px;
  margin-top:12px;
  border-radius:14px;
  border:none;
  font-size:15px;
}
input{background:#fff;color:#000}
button{font-weight:600}
.green{background:#25d366;color:#000}
.blue{background:#3b82f6;color:#fff}
.gray{background:#374151;color:#fff}

/* ===== CHAT ===== */
.chat{
  height:100vh;
  display:flex;
  flex-direction:column;
  background:#0b141a;
}

/* HEADER */
.header{
  background:#075e54;
  padding:12px;
}
.header .title{
  font-weight:700;
}
.header .sub{
  font-size:12px;
  opacity:.8;
}

/* MESSAGES */
.messages{
  flex:1;
  padding:10px;
  overflow-y:auto;
}
.msg{
  max-width:75%;
  padding:10px 14px;
  margin-bottom:8px;
  border-radius:14px;
  font-size:14px;
}
.me{
  background:#dcf8c6;
  color:#000;
  margin-left:auto;
  border-bottom-right-radius:4px;
}
.other{
  background:#1f2937;
  color:#fff;
  border-bottom-left-radius:4px;
}

/* INPUT BAR */
.inputBar{
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px;
  background:#111b21;
}
.inputBar input{
  flex:1;
  border-radius:20px;
  padding:12px 14px;
}
.sendBtn{
  width:44px;
  height:44px;
  border-radius:50%;
  background:#25d366;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="auth">
  <div class="card">
    <h1>Shivanshcodex</h1>
    <input id="lUser" placeholder="Username">
    <input id="lPass" type="password" placeholder="Password">
    <button class="green" onclick="login()">Login</button>
    <button class="gray" onclick="showCreate()">Create Account</button>
    <hr style="margin:16px 0;border:.5px solid #374151">
    <input id="aUser" placeholder="Admin Username">
    <input id="aPass" type="password" placeholder="Admin Password">
    <button class="blue" onclick="adminLogin()">Admin Login</button>
  </div>
</div>

<!-- CREATE -->
<div id="createBox" class="auth hidden">
  <div class="card">
    <h1>Create Account</h1>
    <input id="cUser" placeholder="Username">
    <input id="cPass" type="password" placeholder="Password">
    <button class="green" onclick="createAcc()">Create</button>
    <button class="gray" onclick="back()">Back</button>
  </div>
</div>

<!-- CHAT -->
<div id="chatBox" class="hidden chat">
  <div class="header">
    <div class="title">Shivanshcodex</div>
    <div class="sub">WhatsApp-style Support Chat</div>
  </div>

  <div class="messages" id="msgs"></div>

  <div class="inputBar">
    <input id="msg" placeholder="Type a message">
    <div class="sendBtn" onclick="send()">âž¤</div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, push, get, onChildAdded }
from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const app = initializeApp({
  apiKey:"AIzaSyAYsZ0jwE2uUVM8A0HPkq_cCYWWhb6eVlE",
  authDomain:"shivanshchat-b66da.firebaseapp.com",
  projectId:"shivanshchat-b66da",
  storageBucket:"shivanshchat-b66da.firebasestorage.app",
  messagingSenderId:"715877321366",
  appId:"1:715877321366:web:f7fcb3bb106518978350b7"
});
const db=getDatabase(app);

let user="",admin=false;

window.showCreate=()=>{loginBox.classList.add("hidden");createBox.classList.remove("hidden")}
window.back=()=>{createBox.classList.add("hidden");loginBox.classList.remove("hidden")}

window.createAcc=async()=>{
  if(!cUser.value||!cPass.value) return alert("Fill all fields");
  await set(ref(db,"users/"+cUser.value),{pass:cPass.value});
  alert("Account created");
  back();
};

window.login=async()=>{
  const snap=await get(ref(db,"users/"+lUser.value));
  if(!snap.exists()||snap.val().pass!==lPass.value)
    return alert("Invalid login");
  user=lUser.value;
  openChat();
};

window.adminLogin=()=>{
  if(aUser.value==="shiavnsh@62718"&&aPass.value==="chrome@7282"){
    admin=true;
    openChat();
  }else alert("Wrong admin login");
};

function openChat(){
  loginBox.classList.add("hidden");
  createBox.classList.add("hidden");
  chatBox.classList.remove("hidden");
  msgs.innerHTML="";
  const path=admin?"messages":"messages/"+user;
  onChildAdded(ref(db,path),s=>{
    const m=s.val();
    const d=document.createElement("div");
    d.className="msg "+(m.by==="user"?"me":"other");
    d.innerText=m.text;
    msgs.appendChild(d);
    msgs.scrollTop=msgs.scrollHeight;
  });
}

window.send=()=>{
  if(!msg.value) return;
  const path=admin?"messages":"messages/"+user;
  push(ref(db,path),{text:msg.value,by:admin?"admin":"user"});
  msg.value="";
};
</script>
</body>
</html>
