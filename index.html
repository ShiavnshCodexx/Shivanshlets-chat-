<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Shivansh Admin Chat</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif}
body{background:#0b1220;color:#fff;height:100vh}
.hidden{display:none}

.screen{padding:20px}
input,button{
  width:100%;padding:14px;margin-top:10px;
  border-radius:10px;border:none;font-size:16px
}
button{background:#00ff9c;color:#000;font-weight:600}

.chat{
  display:flex;flex-direction:column;height:100vh
}
.header{
  padding:15px;background:#111b30;
  display:flex;justify-content:space-between;align-items:center
}
.messages{
  flex:1;padding:15px;overflow-y:auto
}
.msg{
  margin-bottom:10px;max-width:80%;
  padding:10px;border-radius:12px
}
.user{background:#00ff9c;color:#000;margin-left:auto}
.admin{background:#222}
.input{
  display:flex;padding:10px;background:#111b30
}
.input input{flex:1}
.input button{width:90px;margin-left:10px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="screen">
  <h2>Login / Signup</h2>
  <input id="username" placeholder="Username">
  <button onclick="login()">Enter Chat</button>
</div>

<!-- CHAT -->
<div id="chat" class="chat hidden">
  <div class="header">
    <span id="title"></span>
    <button onclick="logout()" style="background:red;color:#fff">Logout</button>
  </div>

  <div id="messages" class="messages"></div>

  <div class="input">
    <input id="msg" placeholder="Type message">
    <button onclick="send()">Send</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDwqv5thtLTbc2MBxd0QHXKQMNATubJNqw",
  authDomain: "shivansh-codex-chat.firebaseapp.com",
  projectId: "shivansh-codex-chat",
  storageBucket: "shivansh-codex-chat.firebasestorage.app",
  messagingSenderId: "503775406827",
  appId: "1:503775406827:web:b60495fe496a3d4226acae"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentUser = localStorage.getItem("user");
const isAdmin = currentUser === "admin";

if(currentUser) openChat();

window.login = ()=>{
  const u = username.value.trim();
  if(!u) return alert("Username required");
  localStorage.setItem("user",u);
  currentUser = u;
  openChat();
}

function openChat(){
  login.classList.add("hidden");
  chat.classList.remove("hidden");
  title.innerText = currentUser === "admin" ? "ADMIN PANEL" : "Hello "+currentUser;
  loadMessages();
}

window.send = ()=>{
  if(!msg.value.trim()) return;
  const path = isAdmin ? "chats/"+selectedUser : "chats/"+currentUser;
  push(ref(db,path+"/messages"),{
    from: currentUser,
    text: msg.value,
    time: Date.now()
  });
  msg.value="";
}

function loadMessages(){
  const path = isAdmin ? "chats" : "chats/"+currentUser;
  const mRef = ref(db,path+"/messages");

  onChildAdded(mRef,snap=>{
    const m = snap.val();
    const d = document.createElement("div");
    d.className="msg "+(m.from==="admin"?"admin":"user");
    d.innerText = m.text;
    messages.appendChild(d);
    messages.scrollTop=messages.scrollHeight;
  });
}

window.logout=()=>{
  localStorage.clear();
  location.reload();
}
</script>

</body>
</html>
