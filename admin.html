<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="admin">
  <div class="users" id="users"></div>
  <div class="chat">
    <div id="adminMsgs"></div>
    <input id="reply">
    <button id="send">SEND</button>
  </div>
</div>

<script type="module">
import { db } from "./firebase.js";
import { ref, onValue, push } from
"https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

let current = null;

onValue(ref(db,"users"), snap => {
  users.innerHTML = "";
  snap.forEach(u => {
    let d = document.createElement("div");
    d.innerText = (u.val().online?"ðŸŸ¢ ":"âš« ") + u.key;
    d.onclick = () => openChat(u.key);
    users.appendChild(d);
  });
});

function openChat(u){
  current = u;
  onValue(ref(db,"chats/"+u), s => {
    adminMsgs.innerHTML = "";
    s.forEach(m => {
      adminMsgs.innerHTML += `<div>${m.val().from}: ${m.val().text}</div>`;
    });
  });
}

document.getElementById("send").addEventListener("click", () => {
  if(!current || !reply.value) return;
  push(ref(db,"chats/"+current), {
    from:"admin",
    text:reply.value,
    time:Date.now()
  });
  reply.value = "";
});
</script>

</body>
</html>
